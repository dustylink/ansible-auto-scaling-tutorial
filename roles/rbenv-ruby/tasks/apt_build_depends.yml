---
# roles/rbenv-ruby/tasks/apt_build_depends.yml

- name: Update apt cache
  apt: update_cache=yes
  become: true
  register: result
  until: result|success
  retries: 4
  tags:
    - rbenv-ruby

# required for build essential
- name: Add 'main' repo based on Ubuntu release
  apt_repository: repo='deb http://archive.ubuntu.com/ubuntu {{ansible_distribution_release}} main' state=present
  become: true
  tags:
    - rbenv-ruby

- name: install build depends
  apt: pkg={{ item }} state=present install_recommends=no
  with_items:
    - build-essential
    - git
    - libcurl4-openssl-dev
    - libffi-dev
    - libreadline-dev
    - libssl-dev
    - libxml2-dev
    - libxslt1-dev
    - zlib1g-dev
  become: true
  tags:
    - rbenv-ruby